{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Drivers - {{ vendor.business_name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            margin-top: 30px;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #007bff;
            color: white;
            border-bottom: none;
            border-radius: 10px 10px 0 0;
            padding: 15px;
        }
        .card-body {
            padding: 20px;
        }
        .driver-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .driver-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            border: 2px solid #ddd;
        }
        .driver-details {
            flex-grow: 1;
        }
        .progress {
            height: 15px;
            border-radius: 5px;
            background-color: #e9ecef;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-bar {
            background-color: #17a2b8;
            color: white;
            text-align: center;
            line-height: 15px;
            width: 0%; /* Initial width */
            transition: width 0.6s ease-in-out; /* Smooth animation */
        }
        .btn-outline-secondary {
            border-color: #6c757d;
            color: #6c757d;
        }
        .btn-outline-secondary:hover {
            background-color: #6c757d;
            color: white;
        }
        .alert {
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .delivery-chart-container {
            position: relative;
            width: 100%;
            height: 80px; /* Adjust as needed */
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .delivery-bar {
            position: absolute;
            bottom: 0;
            background-color: #28a745; /* Green for completed */
            height: 0%; /* Initial height */
            width: 100%;
            transition: height 0.6s ease-in-out; /* Smooth animation */
            text-align: center;
            color: white;
            line-height: 80px; /* Vertically center text */
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="mb-0">Your Drivers</h1>
            <a href="{% url 'vendor_dashboard' %}" class="btn btn-primary">
                <i class="fas fa-tachometer-alt me-2"></i> Dashboard
            </a>
        </div>

        {% if messages %}
            <div class="mb-3">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}

        {% if drivers %}
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                {% for driver_data in drivers %}
                    {% with driver=driver_data.driver completed_deliveries=driver_data.completed_deliveries progress_percentage=driver_data.progress_percentage %}
                        <div class="col">
                            <div class="card h-100">
                                <div class="card-header bg-primary text-white">
                                    {{ driver.user.full_name }}
                                </div>
                                <div class="card-body">
                                    <div class="driver-info">
                                        <img src="{{ driver.user.get_photo|default:'https://via.placeholder.com/50' }}"
                                             alt="{{ driver.user.full_name }}" class="driver-photo">
                                        <div class="driver-details">
                                            <h5 class="card-title mb-1">{{ driver.vehicle_type|title }}</h5>
                                            <small class="text-muted">License: {{ driver.license_number }}</small><br>
                                            <small class="text-muted">Status: <span class="badge bg-{% if driver.status == 'A' %}success{% else %}danger{% endif %}">{{ driver.get_status_display }}</span></small><br>
                                            <small class="text-muted">Location: {{ driver.current_location|default:"N/A" }}</small>
                                        </div>
                                    </div>

                                    <h6 class="mt-3 mb-2">Monthly Delivery Progress</h6>
                                    <div class="progress">
                                        <div class="progress-bar bg-info" role="progressbar"
                                             style="width: {{ progress_percentage }}%;"
                                             aria-valuenow="{{ completed_deliveries }}" aria-valuemin="0" aria-valuemax="{{ max_deliveries|default:10 }}">
                                            {{ completed_deliveries }} Deliveries
                                        </div>
                                    </div>
                                    <div class="delivery-chart-container" aria-label="Monthly Delivery Chart for {{ driver.user.full_name }}">
                                        <div class="delivery-bar"
                                             id="deliveryChart_{{ driver.driver_id }}"
                                             data-progress="{{ progress_percentage }}"
                                             data-deliveries="{{ completed_deliveries }}"
                                             style="height: 0%;">
                                            {{ completed_deliveries }} / {{ max_deliveries|default:10 }}
                                        </div>
                                    </div>
                                    <small class="text-muted mt-1">Completed deliveries this month (Max: {{ max_deliveries|default:10 }} for full bar and chart).</small>

                                    <div class="mt-3">
                                        <a href="#" class="btn btn-sm btn-outline-secondary"><i class="fas fa-eye me-1"></i> View Details</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endwith %}
                {% empty %}
                    <div class="col-12">
                        <div class="alert alert-info" role="alert">
                            No drivers are currently associated with your account.
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-warning" role="alert">
                Unable to retrieve driver information at this time.
            </div>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const deliveryBars = document.querySelectorAll('.delivery-bar');
            deliveryBars.forEach(bar => {
                const progress = bar.dataset.progress;
                bar.style.height = progress + '%';
            });

            const progressBars = document.querySelectorAll('.progress-bar');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                // Trigger reflow to enable the transition
                bar.offsetHeight;
                bar.style.width = width;
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>